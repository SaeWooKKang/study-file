# 웹의 개인화

개인정보를 왜 식별해야 할까 ?

쇼핑몰에서 내가 봤던 상품과 유사 상품을 추천하는 경우를 

많이 볼 수 있는데 이러한 추천은 

웹 사이트의 접속 유지시간을 늘려주고 구매율을 올라

회사의 이익에 도움이 된다.

HTTP의 특징은 비연결성, 무상태 프로토콜이다. 

유저와 서버를 지속 연결한다면 서버의 과부화의 원인이되고 

무상태 프로토콜을 유지한다면 서버가 문제가 생겨 스케일 아웃시

요청을 다른 서버로 전달만 해주면 되서(모든 상태를 한 번에 전달해줌으로) 장애 대처시 유리한 측면이 있다. 

따라서 개인을 식별하기 위해서 브라우저에 개인 정보를 저장하는 '쿠키'가 생겼다.

## 쿠키

쿠키는 처음 요청시 HTTP헤더에 쿠키를 받고 브라우저의 쿠키 저장소에 저장된다. 

매 서버에 요청시 쿠키를 함께 전달하여 유저를 식별할 수 있게 됐다.

근데 이러한 개인 정보를 매번 쿠키에 담아 전송하면 전송되는 과정에서 패킷이 탈취 당할 수 있다. 

쿠키의 보안 취약점을 보안하기 위해 '세션'이 등장했다.

## 세션

세션은 쿠키를 사용하는것은 동일하지만 유저의 정보를 서버의 세션 스토리지에 저장한다. 

최초 유저가 서버에 요청시 서버는 세션 스토리지의 개인 정보를 저장하고 PK를 헤더에 담아준다. 

그러면 유저가 다음 요청시 함께 전달한 PK를 가지고 세션스토리지에서 찾아서 개인화를 할 수 있다. 

세션의 단점은 서버의 메모리가 사용된다는 것이고, 세션 스토리지를 탐색하는데 시간이 소요되므로 유저가 몰리면 장애가 발생할 수 있다.

세션의 단점을 보안하고자 토큰이 생겼다.

## 토큰

'토큰'은 유저의 정보를 암호화하여 토큰을 전달해주는데 유저는 HTTP 헤더에 토큰을 넣어 서버에 전달해준다.

전달받은 토큰을 secret key로 복호화하여 유효성을 반펼할 수 있다.

따라서 정보 저장을위한 별도의 공간이 필요하지 않아 서버 과부하를 줄여줄 수있다. 

토큰은 만료되기전에는 계속 유효하기에 문제가 생길 수 있는데 

토큰 유효기간을 짧게 하고 refresh token을 새로 발급해야 한다.

## reference 
> [로앤굿기술블로그](https://tech.lawandgood.com/web-client-identification/)



